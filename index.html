<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bismillah, One Day One Juz</title>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="tampilan.css">
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>

    <script src="supabase.js"></script>
    <script src="app.js"></script>
    <link rel="manifest" href="manifest.json">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#ea580c">
    <meta name="apple-mobile-web-app-status-bar-style" content="#ea580c">
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="ODOJ Talenta">
    
    <!-- iOS Icon (cukup 1 ukuran) -->
    <link rel="apple-touch-icon" href="icon-180x180.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192x192.png">


</head>
<body class="bg-gray-50 min-h-screen">
    <div x-data="quranTracker()" x-init="init()" class="min-h-screen">
        
        <!-- Loading Overlay -->
        <div x-show="isLoading" class="loading-overlay">
            <div class="bg-white rounded-lg p-6 text-center">
                <div class="spinner mx-auto mb-4"></div>
                <p class="text-gray-600 text-sm" x-text="loadingMessage"></p>
            </div>
        </div>

        <!-- Connection Status -->
        <div class="connection-status" 
             :class="{
                'status-online': connectionStatus === 'online',
                'status-offline': connectionStatus === 'offline', 
                'status-connecting': connectionStatus === 'connecting'
             }"
             x-show="connectionStatus !== 'online'">
            <span x-show="connectionStatus === 'connecting'">Menghubungkan...</span>
            <span x-show="connectionStatus === 'offline'">Mode Offline</span>
        </div>

        <!-- Initial Announcement Modal -->
        <div x-show="showAnnouncement" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 modal-backdrop p-3">
            <div class="announcement-modal bg-white rounded-2xl p-5 max-w-lg w-full card-shadow border-t-4 border-primary">
                <div class="text-center">
                    <div class="bg-primary rounded-full w-14 h-14 flex items-center justify-center mx-auto mb-3">
                        <span class="text-white text-2xl">ğŸ“–</span>
                    </div>
                    <h2 class="text-xl font-bold text-gray-800 mb-3">ğŸ“¢ Selamat Datang!</h2>
                    <div class="text-left bg-orange-50 border-l-4 border-primary p-3 rounded-lg mb-4">
                        <h3 class="font-semibold text-gray-800 mb-2 text-sm">âš ï¸ Perhatikan Deskripsi Juz!</h3>
                        <ul class="text-xs text-gray-700 space-y-1.5">
                            <li>â€¢ <strong>WAJIB</strong> membaca deskripsi juz yang akan dibaca</li>
                            <li>â€¢ Ada beberapa juz yang <strong>tidak sesuai</strong> dengan pembagian halaman mushaf</li>
                            <li>â€¢ Penyesuaian dilakukan untuk <strong>menyesuaikan tema</strong> dan kandungan</li>
                            <li>â€¢ Lihat <strong>halaman dan ayat yang tepat</strong> di setiap kartu juz</li>
                        </ul>
                    </div>
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-3 rounded-lg mb-4 text-left">
                        <h3 class="font-semibold text-blue-800 mb-2 text-sm">Doa Sebelum Membaca</h3>
                        <p class="text-xs text-blue-700 italic">
                            "Ya Allah, turunkan rahmat kepada kami dengan wasilah bacaan Al-Qur'an. 
                            Jadikan kami lebih mencintai untuk berinteraksi dengan Al-Qur'an daripada berbuat sia-sia. 
                            Anugerahkan kami pemahaman Al-Qur'an dan pengamalannya. 
                            Perkenankan Al-Qur'an memberi syafaat untuk kami di hari kiamat."
                        </p>
                    </div>
                    <button @click="closeAnnouncement()" 
                            class="w-full btn-primary text-white py-2.5 px-6 rounded-lg font-semibold text-sm hover:bg-red-600 transition-all duration-300">
                        âœ… Alhamdulillah saya paham. Lanjut centang...
                    </button>
                </div>
            </div>
        </div>

        <!-- Edit Participant Modal -->
        <div x-show="showEditParticipant" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-3">
            <div class="bg-white rounded-xl p-5 max-w-md w-full card-shadow"
                 @click.away="showEditParticipant = false">
                <h3 class="text-lg font-bold text-gray-800 mb-4">âœï¸ Edit Nama Peserta</h3>
                
                <div class="space-y-3">
                    <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1.5">Nama Peserta</label>
                        <input x-model="editingParticipant.name" 
                               type="text" 
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm"
                               placeholder="Masukkan nama peserta"
                               @keyup.enter="saveParticipantName()">
                    </div>
                </div>
                
                <div class="flex space-x-3 mt-4">
                    <button @click="showEditParticipant = false" 
                            class="flex-1 py-2 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-all duration-300 text-sm">
                        Batal
                    </button>
                    <button @click="saveParticipantName()" 
                            class="flex-1 py-2 px-4 btn-primary text-white rounded-lg hover:bg-red-600 transition-all duration-300 text-sm">
                        Simpan
                    </button>
                </div>
            </div>
        </div>

        <!-- Header -->
        <header class="gradient-bg text-white shadow-lg">
            <div class="container mx-auto py-3" style="padding-left: 16px !important; padding-right: 16px !important;">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-lg font-bold">One Day One Juz</h1>
                        <p class="text-orange-100 mt-0.5 text-xs">Istiqomah bersama Al Qur'an</p>
                    </div>
                    <div>
                        <div x-show="!isAdmin">
                            <button @click="showAdminLogin = true" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-3 py-1.5 rounded-lg transition-all duration-300 text-xs">
                                Admin
                            </button>
                        </div>
                        <div x-show="isAdmin" class="admin-badge px-3 py-1.5 rounded-lg">
                            <span class="text-white font-semibold text-xs">Admin</span>
                            <button @click="logout()" class="ml-2 text-white hover:text-gray-200 text-xs">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Date Selector -->
        <div class="container mx-auto stats-section">
            <div class="bg-white rounded-xl p-3 card-shadow">
                <div class="flex items-center justify-between">
                    <label class="font-semibold text-gray-700 text-xs">Pilih Tanggal:</label>
                    <div class="flex gap-2">
                        <button 
                            @click="selectedDate = getYesterdayKey()" 
                            :class="selectedDate === getYesterdayKey() ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700'"
                            class="px-3 py-1.5 rounded-lg text-xs font-semibold transition-all duration-300 hover:bg-primary hover:text-white">
                            Kemarin
                        </button>
                        <button 
                            @click="selectedDate = getTodayKey()" 
                            :class="selectedDate === getTodayKey() ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700'"
                            class="px-3 py-1.5 rounded-lg text-xs font-semibold transition-all duration-300 hover:bg-primary hover:text-white">
                            Hari Ini
                        </button>
                    </div>
                </div>
                <div class="mt-2 text-center">
                    <p class="text-xs text-gray-600" x-text="'Menampilkan data: ' + formatDateLabel(selectedDate)"></p>
                </div>
            </div>
        </div>

        <!-- Warning Kemarin -->
        <div x-show="selectedDate === getYesterdayKey()" 
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 transform -translate-y-2"
            x-transition:enter-end="opacity-100 transform translate-y-0"
            class="container mx-auto px-3 pb-2">
            <div class="yesterday-warning rounded-lg p-3">
                <div class="flex items-start gap-2">
                    <span class="text-xl">âš ï¸</span>
                    <div>
                        <p class="text-xs font-semibold text-amber-900">Centang untuk Kemarin</p>
                        <p class="text-xs text-amber-800">Anda sedang mencentang data kemarin. Pastikan sudah benar.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats -->
        <!-- Stats -->
        <div class="container mx-auto stats-section">
            <div class="grid grid-cols-3 gap-2">
                <div class="bg-white rounded-xl p-3 card-shadow">
                    <div class="flex flex-col items-center text-center">
                        <h3 class="text-gray-500 text-[10px] mb-0.5">Tanggal</h3>
                        <p class="text-xs font-bold text-gray-800 leading-tight" x-text="formatDateLabel(selectedDate)"></p>  <!-- ğŸ‘ˆ YANG INI DIUBAH -->
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-3 card-shadow">
                    <div class="flex flex-col items-center text-center">
                        <h3 class="text-gray-500 text-[10px] mb-0.5">Selesai</h3>
                        <p class="text-xs font-bold text-gray-800"><span x-text="getTodayCompleted()"></span>/30</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-3 card-shadow" :class="{'khatam-celebration': getTodayCompleted() === 30}">
                    <div class="flex flex-col items-center text-center">
                        <h3 class="text-gray-500 text-[10px] mb-0.5">Status</h3>
                        <p class="text-xs font-bold text-gray-800 leading-tight" x-text="getTodayCompleted() === 30 ? 'KHATAM! ğŸ‰' : (30 - getTodayCompleted()) + ' lagi'"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="container mx-auto tab-section">
            <div class="bg-white rounded-xl p-1.5 card-shadow">
                <div class="flex space-x-1">
                    <button @click="activeTab = 'checklist'" 
                            :class="activeTab === 'checklist' ? 'bg-primary text-white' : 'text-gray-600 hover:text-primary'"
                            class="flex-1 py-2 px-2 rounded-lg font-semibold transition-all duration-300 text-xs">
                        Checklist
                    </button>
                    <button @click="activeTab = 'monthly'" 
                            :class="activeTab === 'monthly' ? 'bg-primary text-white' : 'text-gray-600 hover:text-primary'"
                            class="flex-1 py-2 px-2 rounded-lg font-semibold transition-all duration-300 text-xs">
                        Rekap
                    </button>
                    <button x-show="isAdmin" @click="activeTab = 'admin'" 
                            :class="activeTab === 'admin' ? 'bg-primary text-white' : 'text-gray-600 hover:text-primary'"
                            class="flex-1 py-2 px-2 rounded-lg font-semibold transition-all duration-300 text-xs">
                        Admin
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab Content: Checklist Harian -->
        <div x-show="activeTab === 'checklist'" class="container mx-auto pb-20">
            <div class="grid grid-cols-2">
                <template x-for="(participant, index) in getRotatedParticipants()" :key="participant.id">
                    <div class="juz-card bg-white rounded-xl card-shadow relative" 
                         :class="{'completed': isCompleted(participant.id)}"
                         @click="toggleCheck(participant.id)">
                        
                        <!-- Edit Button (Admin Only) -->
                        <button x-show="isAdmin" 
                                @click.stop="editParticipant(participant)"
                                class="edit-participant-btn">
                            âœï¸
                        </button>

                        <!-- Juz Header -->
                        <div class="flex justify-between items-start">
                            <div class="flex items-baseline gap-2">
                                <h3 :class="isCompleted(participant.id) ? 'text-white' : 'text-gray-800'" x-text="'Juz ' + (index + 1)"></h3>
                                <p class="text-[11px]" :class="isCompleted(participant.id) ? 'text-orange-100' : 'text-gray-500'" x-text="getJuzDetails(index + 1).name"></p>
                            </div>
                            <div class="text-xl" x-text="isCompleted(participant.id) ? 'âœ…' : 'â³'"></div>
                        </div>
                        
                        <!-- Participant Info -->
                        <div>
                            <h4 :class="isCompleted(participant.id) ? 'text-white' : 'text-gray-700'" x-text="participant.name"></h4>
                            <p class="text-[11px]" :class="isCompleted(participant.id) ? 'text-orange-100' : 'text-gray-500'" x-text="'Hal. ' + getJuzDetails(index + 1).pages"></p>
                        </div>
                        
                        <!-- Juz Content -->
                        <div style="flex-grow: 1;">
                            <p :class="isCompleted(participant.id) ? 'text-orange-100' : 'text-gray-600'" x-text="getJuzDetails(index + 1).content"></p>
                        </div>
                        
                        <!-- Status -->
                        <div class="text-center">
                            <span :class="isCompleted(participant.id) ? 'text-white' : 'text-gray-500'">
                                <span x-show="isCompleted(participant.id)">âœ… Selesai</span>
                                <span x-show="!isCompleted(participant.id)">â³ Belum</span>
                            </span>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Tab Content: Rekap Bulanan -->
        <div x-show="activeTab === 'monthly'" class="container mx-auto pb-20">
            <!-- Month Selection -->
            <div class="bg-white rounded-xl p-3 card-shadow mb-3">
                <div class="flex items-center space-x-3">
                    <label class="font-semibold text-gray-700 text-xs">Bulan:</label>
                    <select x-model="selectedMonth" @change="updateMonthlyView()" 
                            class="flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent text-xs">
                        <template x-for="month in availableMonths" :key="month.value">
                            <option :value="month.value" x-text="month.label"></option>
                        </template>
                    </select>
                </div>
            </div>

            <!-- Monthly Stats -->
            <div class="grid grid-cols-2 gap-2 mb-3">
                <div class="bg-white rounded-xl p-3 card-shadow">
                    <div class="flex items-center">
                        <div>
                            <h3 class="text-gray-500 text-[10px]">Total Khatam</h3>
                            <p class="text-lg font-bold text-yellow-600" x-text="getMonthlyKhatam()"></p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-3 card-shadow">
                    <div class="flex items-center">
                        <div>
                            <h3 class="text-gray-500 text-[10px]">Partisipasi</h3>
                            <p class="text-lg font-bold text-primary" x-text="getTotalMonthlyChecks()"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monthly Progress Table -->
            <div class="bg-white rounded-xl card-shadow overflow-hidden">
                <div class="p-3 border-b border-gray-200">
                    <h3 class="text-sm font-bold text-gray-800">Progress Peserta</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-xs">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-2 text-left text-[10px] font-medium text-gray-500 uppercase">Peserta</th>
                                <th class="px-3 py-2 text-left text-[10px] font-medium text-gray-500 uppercase">Centang</th>
                                <th class="px-3 py-2 text-left text-[10px] font-medium text-gray-500 uppercase">%</th>
                                <th class="px-3 py-2 text-left text-[10px] font-medium text-gray-500 uppercase">Progress</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <template x-for="participant in participants" :key="participant.id">
                                <tr class="hover:bg-gray-50">
                                    <td class="px-3 py-2">
                                        <div class="text-xs font-medium text-gray-900" x-text="participant.name"></div>
                                    </td>
                                    <td class="px-3 py-2">
                                        <div class="text-xs text-gray-900" x-text="getParticipantMonthlyCount(participant.id) + '/' + getDaysInMonth()"></div>
                                    </td>
                                    <td class="px-3 py-2">
                                        <div class="text-xs text-gray-900" x-text="Math.round((getParticipantMonthlyCount(participant.id) / getDaysInMonth()) * 100) + '%'"></div>
                                    </td>
                                    <td class="px-3 py-2">
                                        <div class="w-full bg-gray-200 rounded-full h-1.5">
                                            <div class="bg-primary h-1.5 rounded-full transition-all duration-500" 
                                                 :style="'width: ' + Math.round((getParticipantMonthlyCount(participant.id) / getDaysInMonth()) * 100) + '%'"></div>
                                        </div>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab Content: Admin -->
        <div x-show="activeTab === 'admin' && isAdmin" class="container mx-auto px-3 pb-20">
            <div class="bg-white rounded-xl p-4 card-shadow">
                <h3 class="text-base font-bold text-gray-800 mb-4">ğŸ”§ Panel Admin</h3>
                
                <div class="space-y-3">
                    <!-- Export WhatsApp Data -->
                    <div class="border border-gray-200 rounded-lg p-3">
                        <h4 class="text-sm font-semibold text-gray-800 mb-2">ğŸ“¤ Ekspor Data WhatsApp</h4>
                        <p class="text-xs text-gray-600 mb-3">
                            Export data progress hari ini dalam format yang siap untuk dibagikan ke berbagai grup.
                        </p>
                        
                        <button @click="generateWhatsAppExport()" 
                                class="btn-primary text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-all duration-300 text-xs font-semibold w-full">
                            ğŸ“± Kirim laporan ke Grup Odoj
                        </button>
                        
                        <div x-show="exportText" class="mt-3">
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-xs font-medium text-gray-700">Hasil Export:</label>
                                <button @click="copyToClipboard()" 
                                        class="text-[10px] px-2 py-1 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-all">
                                    ğŸ“‹ Copy
                                </button>
                            </div>
                            <div class="export-text" x-text="exportText"></div>
                            <p class="text-[10px] text-gray-500 mt-2">
                                âœ… Data berhasil di-generate! Klik "Copy" lalu paste ke WhatsApp grup.
                            </p>
                        </div>
                    </div>

                    <!-- Manage Participants -->
                    <div class="border border-purple-200 rounded-lg p-3 bg-purple-50">
                        <h4 class="text-sm font-semibold text-purple-800 mb-2">Kelola Peserta</h4>
                        <p class="text-xs text-purple-700 mb-3">
                            Edit nama peserta sesuai kebutuhan.
                        </p>
                        
                        <div class="space-y-2 max-h-96 overflow-y-auto">
                            <template x-for="participant in participants" :key="participant.id">
                                <div class="flex items-center gap-2 bg-white p-2 rounded-lg border border-purple-200">
                                    <div class="flex-shrink-0 w-12 text-center">
                                        <span class="text-xs font-bold text-purple-600" x-text="'#' + participant.id"></span>
                                    </div>
                                    <div class="flex-1">
                                        <input 
                                            type="text" 
                                            :value="participant.name"
                                            @blur="updateParticipantName(participant.id, $event.target.value)"
                                            @keyup.enter="$event.target.blur()"
                                            class="w-full border border-gray-300 rounded px-2 py-1 text-xs focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                            placeholder="Nama peserta">
                                    </div>
                                    <button 
                                        @click="quickEditParticipant(participant)"
                                        class="flex-shrink-0 bg-purple-500 text-white px-2 py-1 rounded text-xs hover:bg-purple-600 transition-all">
                                        âœï¸
                                    </button>
                                </div>
                            </template>
                        </div>
                        
                        <div class="mt-3 p-2 bg-white rounded border border-purple-200">
                            <p class="text-[10px] text-purple-700">
                                ğŸ’¡ <strong>Tip:</strong> Klik pada nama untuk edit langsung, atau klik tombol âœï¸ 
                            </p>
                        </div>
                    </div>

                    <!-- Debug Data 
                    <div class="border border-blue-200 rounded-lg p-3 bg-blue-50">
                        <h4 class="text-sm font-semibold text-blue-800 mb-2">ğŸ” Debug Data</h4>
                        <p class="text-xs text-blue-700 mb-3">
                            Untuk mengecek apakah data rekap bulanan tersimpan dengan benar.
                        </p>
                        
                        <button @click="debugMonthlyData()" 
                                class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-all duration-300 text-xs font-semibold w-full">
                            ğŸ” Debug Monthly Data
                        </button>
                        
                        <div x-show="debugResult" class="mt-3 p-2 rounded bg-gray-100">
                            <pre class="text-[10px] overflow-x-auto" x-text="debugResult"></pre>
                        </div>
                    </div>

                     Force Sync 
                    <div class="border border-green-200 rounded-lg p-3 bg-green-50">
                        <h4 class="text-sm font-semibold text-green-800 mb-2">ğŸ”„ Force Sync Data</h4>
                        <p class="text-xs text-green-700 mb-3">
                            Paksa sinkronisasi semua data lokal ke Supabase.
                        </p>
                        
                        <button @click="forceSyncAllData()" 
                                class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-all duration-300 text-xs font-semibold w-full"
                                :disabled="!supabaseConnected">
                            ğŸš€ Force Sync ke Supabase
                        </button>
                        
                        <p x-show="!supabaseConnected" class="text-[10px] text-red-600 mt-2">
                            âš ï¸ Supabase tidak terhubung.
                        </p>
                    </div>-->

                    <!-- Supabase Connection Test -->
                    <div class="border border-blue-200 rounded-lg p-3 bg-blue-50">
                        <h4 class="text-sm font-semibold text-blue-800 mb-2">ğŸ”§ Test Koneksi Supabase</h4>
                        <p class="text-xs text-blue-700 mb-3">
                            Uji koneksi
                        </p>
                        
                        <button @click="testSupabaseConnection()" 
                                class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-all duration-300 text-xs font-semibold w-full">
                            ğŸ§ª Test Koneksi
                        </button>
                        
                        <div x-show="connectionTestResult" class="mt-3 p-2 rounded text-xs" :class="connectionTestSuccess ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                            <p x-text="connectionTestResult"></p>
                        </div>
                    </div>

                    <!-- Reset System -->
                    <div class="border border-red-200 rounded-lg p-3 bg-red-50">
                        <h4 class="text-sm font-semibold text-red-800 mb-2">ğŸ”„ Reset Sistem</h4>
                        <p class="text-xs text-red-700 mb-3">
                            <strong>Peringatan:</strong> Ini akan menghapus semua data progress.
                        </p>
                        
                        <button @click="resetSystem()" 
                                class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-all duration-300 text-xs font-semibold w-full">
                            ğŸ—‘ï¸ Reset Semua Data
                        </button>
                    </div>

                    <!-- Data Info -->
                    <div class="border border-gray-200 rounded-lg p-3">
                        <h4 class="text-sm font-semibold text-gray-800 mb-2">ğŸ’¾ Informasi Data</h4>
                        <div class="space-y-1 text-xs">
                            <p><strong>Status:</strong> 
                                <span :class="supabaseConnected ? 'text-green-600' : 'text-orange-600'" 
                                      x-text="supabaseConnected ? 'ğŸŸ¢ Connected' : 'ğŸŸ  Offline'"></span>
                            </p>
                            <p><strong>Penyimpanan:</strong> 
                                <span x-text="supabaseConnected ? 'Supabase + Local' : 'Local Storage'"></span>
                            </p>
                            <p><strong>Sync:</strong> 
                                <span :class="supabaseConnected ? 'text-green-600' : 'text-red-600'" 
                                      x-text="supabaseConnected ? 'âœ… Aktif' : 'âŒ Nonaktif'"></span>
                            </p>
                            <p><strong>Peserta:</strong> <span x-text="participants.length"></span></p>
                            <p><strong>Selesai:</strong> <span x-text="getTodayCompleted()"></span></p>
                            <div x-show="supabaseConnected" class="mt-2 p-2 bg-green-50 rounded">
                                <p class="text-green-700 text-[10px]">
                                    <strong>ğŸ”„ Multi-Device:</strong> Centang dari device manapun akan sync otomatis.
                                </p>
                            </div>
                            <div x-show="!supabaseConnected" class="mt-2 p-2 bg-orange-50 rounded">
                                <p class="text-orange-700 text-[10px]">
                                    <strong>ğŸ“± Single Device:</strong> Data tersimpan lokal di browser ini saja.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Login Modal -->
        <div x-show="showAdminLogin" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-3">
            <div class="bg-white rounded-xl p-5 max-w-md w-full card-shadow"
                 @click.away="showAdminLogin = false">
                <h3 class="text-lg font-bold text-gray-800 mb-4">Admin Login</h3>
                
                <div class="space-y-3">
                    
                    <div>
                        <label class="block text-xs font-medium text-gray-700 mb-1.5">Password</label>
                        <input x-model="adminCredentials.password" 
                               type="password" 
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm"
                               placeholder="Masukkan password"
                               @keyup.enter="adminLogin()">
                    </div>
                </div>
                
                <div x-show="adminError" class="mt-3 p-2 bg-red-100 border border-red-400 text-red-700 rounded-lg text-xs" x-text="adminError"></div>
                
                <div class="flex space-x-3 mt-4">
                    <button @click="showAdminLogin = false" 
                            class="flex-1 py-2 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-all duration-300 text-sm">
                        Batal
                    </button>
                    <button @click="adminLogin()" 
                            class="flex-1 py-2 px-4 btn-primary text-white rounded-lg hover:bg-red-600 transition-all duration-300 text-sm">
                        Login
                    </button>
                </div>
            </div>
        </div>

        <!-- Floating Action Buttons -->
        <div class="floating-buttons">
            <a href="https://wa.me/6282131832711?text=Assalamu'alaikum, saya ingin bertanya-tanya tentang aplikasi ODOJ" 
               target="_blank" 
               class="floating-btn whatsapp-btn" 
               title="Tanya Jawab WhatsApp">
                <span class="text-lg">ğŸ’¬</span>
            </a>
        <!--    <a href="https://sites.google.com/view/keluargaquran/home" 
               target="_blank"
               class="floating-btn donate-btn" 
               title="Infaq">
                <span class="text-lg">ğŸ’°</span>
            </a>-->
        </div>
    </div>
<script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('âœ… Service Worker registered successfully:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('ğŸ”„ Service Worker update found');
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('ğŸ†• New Service Worker available. Refresh to update.');
                                    // Optional: Show notification to user
                                    // alert('Update tersedia! Refresh halaman untuk mendapatkan versi terbaru.');
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('âŒ Service Worker registration failed:', error);
                    });
            });

            // Listen for messages from Service Worker
            navigator.serviceWorker.addEventListener('message', event => {
                console.log('ğŸ“¨ Message from Service Worker:', event.data);
                
                if (event.data.type === 'SYNC_REQUIRED') {
                    console.log('ğŸ”„ Triggering data sync...');
                    // Trigger sync function dari Alpine.js component jika ada
                    // window.dispatchEvent(new CustomEvent('sync-required'));
                }
            });
        } else {
            console.warn('âš ï¸ Service Worker not supported in this browser');
        }

        // Online/Offline detection
        window.addEventListener('online', () => {
            console.log('ğŸŸ¢ App is online');
            // Optional: trigger sync atau update UI
        });

        window.addEventListener('offline', () => {
            console.log('ğŸ”´ App is offline');
            // Optional: show offline indicator
        });

        // Before Install Prompt (untuk "Add to Home Screen")
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log(' Install prompt available');
            e.preventDefault();
            deferredPrompt = e;
            
            // Optional: Tampilkan custom "Add to Home Screen" button
            // Misalnya bisa ditambahkan di header atau sebagai floating button
        });

        // Detect if app is installed
        window.addEventListener('appinstalled', () => {
            console.log('App installed to home screen');
            deferredPrompt = null;
        });
    </script>

</body>
</html>
